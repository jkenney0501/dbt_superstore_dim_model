version: 2

models:
  # employees history
  - name: dim_employees_history
    description: history employees dimension
    columns:
      - name: emp_surr_id
        description: primary key for employees dimension, this will not be unique as this is an scd type 2
        tests:
          - not_null
      - name: emp_id
        description: natural key for employees dimension, this will not be unique as this is an scd type 2
        tests:
          - not_null
      - name: first_name
        description: employee first name
        tests:
          - not_null
      - name: last_name
        description: employee last name
        tests:
          - not_null
      - name: level
        description: employee level of job title i.e VP, SVP etc.
        tests:
          - not_null
      - name: state
        description: employeestate of employment
        tests:
          - not_null
      - name: age
        description: employee current age
        tests:
          - not_null
      - name: hire_date
        description: employee date of hire
        tests:
          - not_null
      - name: job_title
        description: employee job title
        tests:
          - not_null
      - name: status
        description: employee job status i.e active = A, teminated = T, leave of absence = L/A
        tests:
          - not_null
          - accepted_values:
              values:
                - 'A'
                - 'L/A'
                - 'T'
      - name: valid_from
        description: employee date of validity
        tests:
          - not_null
      - name: valid_to
        description: employee date of change validity
        tests:
          - not_null
      - name: is_current
        description: employee current flag to show if the record is the most recent one. Rfer to hist for previous records.
        tests:
          - not_null
  
# employees current
  - name: dim_employees_current
    description: employees dimension
    columns:
      - name: emp_surr_id
        description: primary key for employees dimension, this will be unique as this the current version of employees where scd os curent = 1
        tests:
          - unique
          - not_null
      - name: emp_id
        description: primary key for employees dimension, this will be unique as this the current version of employees where scd os curent = 1
        tests:
          - unique
          - not_null
      - name: first_name
        description: employee first name
        tests:
          - not_null
      - name: last_name
        description: employee last name
        tests:
          - not_null
      - name: level
        description: employee level of job title i.e VP, SVP etc.
        tests:
          - not_null
      - name: state
        description: employee state of employment
        tests:
          - not_null
      - name: age
        description: employee current age
        tests:
          - not_null
      - name: hire_date
        description: employee date of hire
        tests:
          - not_null
      - name: job_title
        description: employee job title
        tests:
          - not_null
      - name: status
        description: employee job status i.e active = A, teminated = T, leave of absence = L/A
        tests:
          - not_null
          - accepted_values:
              values:
                - 'A'
                - 'L/A'
                - 'T'
      - name: valid_from
        description: employee date of validity
        tests:
          - not_null
      - name: valid_to
        description: employee date of change validity
        tests:
          - not_null
     


# EMPLOYEES contract- uses hisgtory given current pulls from history table where is-current = 1
  - name: dim_employees_history
    description: An employee history table that tracks history of all employee actions within the company, modeled as SCD type 2.
    config:
      contract:
        enforced: true

    columns:
      - name: emp_surr_id
        description: primary for employees table. Using most recent record to capturee uniqness.
        data_type: varchar
      - name: emp_id
        description: primary/natural key for employees table. Using most recent record to capturee uniqness.
        data_type: number
      - name: first_name
        description: The employees legal first name.
        data_type: varchar
      - name: last_name
        description: The employees legal last name.
        data_type: varchar
      - name: level
        description: The mployees job level.
        data_type: varchar
      - name: state
        description: The state where the employee resides.
        data_type: varchar
      - name: age
        description: The legal age of the employee.
        data_type: number
      - name: hire_date
        description: The date the employee was hired.
        data_type: date
      - name: job_title
        description: The employee job title.
        data_type: varchar
      - name: status
        description: The status at the period of time selected. This can be 'A' for active, 'T' for terminated or 'LA' for leav of absence. 
        data_type: varchar
      - name: valid_from
        description: The date the employee was active from in his or her recent position.
        data_type: timestamp
      - name: valid_to
        description: The date the employee was active to in his or her recent position.
        data_type: timestamp
      - name: is_current
        description: A flag that shows 1 for the most recent record and 0 for historical records. 
        data_type: number
      - name: updated_at
        description: batch load date. 
        data_type: timestamp_ntz