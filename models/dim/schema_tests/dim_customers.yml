version: 2

models:
  # customers history
  - name: dim_customers_history
    description: creates customers current dimension
    columns: 
      - name: cust_surr_id
        description: primary key for customers history dimension, will not be unique becasue it is an scd type 2
        tests:
          - not_null
      - name: customer_id
        description: natural key for customers history dimension, will not be unique becasue it is an scd type 2
        tests:
          - not_null
      - name: customer_name
        tests:
          - not_null
      - name: valid_from
          - not_null
      - name: valid_to 
          - not_null
  
# customers current
  - name: dim_customers_current
    description: creates customers current dimension
    columns: 
      - name: cust_surr_id
        description: primary surrogate key for customers history dimension, will be unique becasue it is only current employees
        tests:
          - not_null
          - unique
      - name: customer_id
        description: natural key for customers history dimension, will be unique becasue it is only current employees
        tests:
          - not_null
          - unique
      - name: customer_name
        tests:
          - not_null
      - name: valid_from
          - not_null
      - name: valid_to 
          - not_null
   
# CUSTOMERS contract - uses hist given current pills from hist where is_current = 1
  - name: dim_customers_history
    description: Customers dimension table, modeled as SCD type 2.
    config:
      contract:
        enforced: true
    columns:
      - name: cust_surr_id
        description: Customer table primary key.
        data_type: varchar
      - name: customer_id
        description: Customer table natural key. This is the system generated natural key.
        data_type: varchar
      - name: customer_name
        description: Customer full name, both first and last.
        data_type: varchar
      - name: valid_from
        description: The date the employee was active from in his or her recent position.
        data_type: timestamp
      - name: valid_to
        description: The date the employee was active to in his or her recent position.
        data_type: timestamp
      - name: is_current
        description: A flag that shows 1 for the most recent record and 0 for historical records.
        data_type: number
      - name: updated_at
        description: batch load date.
        data_type: timestamp_ntz