version: 2

models:
  # products current
  - name: dim_products_history
    description: creates products history dimension
    columns: 
      - name: prod_surr_id
        description: primary key for customers history dimension, will not be unique becasue it is an scd type 2
        tests:
          - not_null
      - name: product_id
        description: natural key for product history dimension, will be unique becasue it is only current employees
        tests: 
          - not_null
      - name: category
        tests:
          - not_null
      - name: product_name
        tests:
          - not_null
      - name: sub_category
        tests:
          - not_null
      - name: valid_from
          - not_null
      - name: valid_to 
          - not_null
      - name: is_current
        tests:
          - not_null
      
  
# products history
  - name: dim_products_current
    description: creates products current dimension
    columns: 
      - name: prod_surr_id
        description: primary surrogate key for product history dimension, will be unique becasue it is only current employees
        tests:
          - unique   
          - not_null
      - name: product_id
        description: natural key for product history dimension, will be unique becasue it is only current employees
        tests: 
          - not_null
      - name: category
        tests:
          - not_null
      - name: product_name
        tests:
          - not_null
      - name: sub_category
        tests:
          - not_null
      - name: valid_from
          - not_null
      - name: valid_to 
          - not_null
     
   
# PRODUCTS - uses hist given current pills from hist where is_current = 1
  - name: dim_products_history
    description: Product dimension, modeled as SCD type 2.
    config:
      contract:
        enforced: true
    columns:
      - name: prod_surr_id
        description: Product primary key. This is a surrogate key composed of the id, category, subcategory and name.
        data_type: varchar
      - name: product_id
        description: natural key, is not unique, can be duplicated.
        data_type: varchar
      - name: category
        description: Fisrt level of category for product.
        data_type: varchar
      - name: sub_category
        description: The sub category of the product, second level of heirarchy from category.
        data_type: varchar
      - name: product_name
        description: The name of the product in long form.
        data_type: varchar
      - name: valid_from
        description: The date the employee was active from in his or her recent position.
        data_type: timestamp
      - name: valid_to
        description: The date the employee was active to in his or her recent position.
        data_type: timestamp
      - name: is_current
        description: A flag that shows 1 for the most recent record and 0 for historical records.
        data_type: number
      - name: updated_at
        description: batch load date.
        data_type: timestamp_ntz
